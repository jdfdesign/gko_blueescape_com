/*
 * jQuery Mobile Framework : plugin to provide a simple popup (modal) or jQMdialog (page) Dialog widget.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notifcation.
 * https://github.com/jtsage/jquery-mobile-simpledialog
 */
(function(a,b){a.widget("mobile.simpledialog",a.mobile.widget,{options:{pickPageTheme:"b",pickPageInputTheme:"e",pickPageButtonTheme:"a",disabled:!1,zindex:"500",width:"280px",prompt:"Are you sure?",mode:"bool",allowReopen:!0,useModal:!0,forceInput:!0,isOpen:!1,blankMode:!1,fullHTML:null,subTitle:!1,inputPassword:!1,cleanOnClose:!1,animate:!0,transition:"pop",clickEvent:"click",left:b,top:b,useDialogForceTrue:!1,useDialogForceFalse:!1,useDialog:!1,isInit:!1,sawOnce:!1,enterToTrigger:0,escToTrigger:1,butObj:[],debug:!1,selects:!1,selectparent:[],onCreated:null,onOpened:null,onClosed:null,onShown:null},_eventHandler:function(b,c){var d=a(this).data("simpledialog"),e=d.options;if(!b.isPropagationStopped())switch(c.method){case"close":d.close(c.fromCloseButton);break;case"open":d.open();break;case"refresh":d.refresh();break;case"button":e.butObj[c.index].trigger(e.clickEvent)}},_orientChange:function(b){var c=a(b.currentTarget).data("simpledialog");o=c.options,docWinWidth=a(document).width(),docWinHeightOffset=a(window).scrollTop(),docWinHeight=a(window).height(),pickWinHeight=c.pickerContent.outerHeight(),pickWinWidth=c.pickerContent.innerWidth(),pickWinTop=parseFloat(o.top)+1e4?parseFloat(o.top):docWinHeightOffset+docWinHeight/2-pickWinHeight/2,pickWinLeft=parseFloat(o.left)+1e4?parseFloat(o.left):docWinWidth/2-pickWinWidth/2,pickWinHeight+pickWinTop>a(document).height()&&(pickWinTop=a(document).height()-(pickWinHeight+2)),pickWinTop<45&&(pickWinTop=45),b.stopPropagation();if(!c.pickerContent.is(":visible")||o.useDialog===!0)return!1;c.pickerContent.css({top:pickWinTop,left:pickWinLeft})},open:function(){if(this.pickPage.is(":visible"))return!1;var b=this,c=this.options,d=a(document).width(),e=a(window).scrollTop(),f=a(window).height(),g=b.pickerContent.outerHeight(),h=b.pickerContent.innerWidth(),i=parseFloat(c.top)+1e4?parseFloat(c.top):e+f/2-g/2,j=parseFloat(c.left)+1e4?parseFloat(c.left):d/2-h/2;g+i>a(document).height()&&(i=a(document).height()-(g+2)),i<45&&(i=45),c.prompt!==!1&&(b.pickerHeader.html(c.prompt),b.pickPage.find(".ui-header").find(".ui-title").text(c.prompt)),b.pickerContent.find(".ui-btn-active").removeClass("ui-btn-active"),c.mode==="blank"&&b.pickerContent.delegate('[rel="close"]',c.clickEvent,function(){b.close()}),c.disabled||(d>400&&!c.useDialogForceTrue||c.useDialogForceFalse?(c.useDialog=!1,c.useModal?c.animate===!0?b.screen.fadeIn("slow"):b.screen.show():b.screen.removeClass("ui-simpledialog-hidden"),c.mode==="blank"&&(c.selects=b.pickPage.find(".ui-selectmenu"),c.selects.each(function(){c.selectparent.push(a(this).closest(".ui-dialog")),a(this).appendTo(b.thisPage)})),b.pickerContent.addClass("ui-overlay-shadow").css("zIndex",b.options.zindex),b.pickerHeader.show(),b.pickerContent.css({position:"absolute",top:i,left:j}).addClass("ui-overlay-shadow in").removeClass("ui-simpledialog-hidden")):(b.thisPage.unbind("pagehide.remove"),c.useDialog=!0,b.pickPageContent.append(b.pickerContent),b.pickerHeader.hide(),b.pickerContent.removeClass("ui-overlay-shadow ui-simpledialog-hidden").css({top:"auto",left:"auto",marginLeft:"auto",marginRight:"auto"}).css("zIndex",b.options.zindex),a.mobile.changePage(b.pickPage,{transition:c.animate===!0?c.transition:"none"})),this.options.isOpen=!0)},close:function(b){var c=this,b=typeof b=="undefined"?!1:b;c.options.useDialog?(b===!1&&a(c.pickPage).dialog("close"),c.thisPage.data("page").options.domCache||c.thisPage.bind("pagehide.remove",function(){a(c).remove()}),c.pickerContent.addClass("ui-simpledialog-hidden"),c.thisPage.append(c.pickerContent)):(c.options.useModal?c.options.animate===!0?c.screen.fadeOut("slow"):c.screen.hide():c.screen.addClass("ui-simpledialog-hidden"),c.pickerContent.addClass("ui-simpledialog-hidden").removeClass("in")),c.caller.removeClass("ui-btn-active"),c.options.isOpen=!1,c.options.cleanOnClose===!0&&c.options.useDialog===!1&&c.clean(),c.options.onClosed&&typeof c.options.onClosed=="function"&&c.options.onClosed(c)},clean:function(){var b=this;b.options.selects!==!1&&(b.options.selects.each(function(){a(this).remove()}),a(b.options.selectparent).each(function(){a(this).remove()})),b.pickerContent.remove(),b.pickPage.remove(),b.screen.remove(),b.caller.removeData("simpledialog")},_create:function(){var b=this,c=a.extend(this.options,this.element.data("options")),d=this.element;if(c.isInit&&c.allowReopen)b.open();else{var e=d.closest(".ui-page"),f=a("<div data-role='dialog' class='ui-simpledialog-dialog' data-theme='"+c.pickPageTheme+"' >"+"<div data-role='header' data-backbtn='false' data-theme='a'>"+"<div class='ui-title'>"+c.prompt+"</div>"+"</div>"+"<div data-role='content'></div>"+"</div>"),g=null,h=null;c.mode==="blank"&&(g=a("<div class='ui-simpledialog-container ui-overlay-shadow ui-corner-all ui-simpledialog-hidden "+(c.animate===!0?c.transition:"")+" ui-body-"+c.pickPageTheme+"'></div>"),g.html(c.fullHTML),a("[data-role=content]",f).append(g)),f.appendTo(a.mobile.pageContainer).page().css("minHeight","0px").css("zIndex",c.zindex),c.animate===!0&&f.addClass("pop"),h=f.find(".ui-content"),d.live("simpledialog",b._eventHandler),f.find(".ui-header a").bind(c.clickEvent,function(a){a.preventDefault(),a.stopImmediatePropagation(),b.close(!0)}),c.prompt===!1&&f.find(".ui-header").find(".ui-title").html("&nbsp;"),a.extend(b,{pickPage:f,thisPage:e,pickPageContent:h,screen:screen,caller:d}),b._buildPage(),b.options.isInit=!0,a(document).bind("orientationchange",function(a){d.trigger("orientationchange")}),d.bind("orientationchange",b._orientChange),b.options.onCreated&&typeof b.options.onCreated=="function"&&b.options.onCreated(b)}},_reposition:function(){var b=this,c=this.options,d=a(document).width(),e=a(window).scrollTop(),f=a(window).height(),g=b.pickerContent.outerHeight(),h=b.pickerContent.innerWidth(),i=parseFloat(c.top)+1e4?parseFloat(c.top):e+f/2-g/2,j=parseFloat(c.left)+1e4?parseFloat(c.left):d/2-h/2;g+i>a(document).height()&&(i=a(document).height()-(g+2)),i<45&&(i=45),b.pickerContent.css({position:"absolute",width:h,top:i,left:j})},refresh:function(){if(!this.options.mode==="blank")return!1;this.pickerContent.css("width","auto"),this.pickerContent.html(this.options.fullHTML),this.pickerContent.trigger("create"),this.pickerContent.is(":visible")&&this.options.useDialog===!1&&this._reposition()},_init:function(){if(!this.options.sawOnce||this.options.allowReopen)this.options.sawOnce=!0,this.open()},_buildPage:function(){var b=this,c=b.options,d=null,e,f,g,h=a("<div>",{"class":"ui-simpledialog-container ui-overlay-shadow ui-corner-all ui-simpledialog-hidden "+(c.animate===!0?c.transition:"")+" ui-body-"+c.pickPageTheme}).css({zIndex:c.zindex,width:c.width}),i=a("<div class='ui-simpledialog-header'><h4></h4></div>").appendTo(h).find("h4");h.bind("webkitAnimationEnd",function(){b.options.onShown&&typeof b.options.onShown=="function"&&b.options.onShown(b)}),c.mode!=="blank"?(c.prompt!==!1?i.html(c.prompt):i.parent().html(),c.subTitle!==!1&&a("<p class='ui-simpledialog-subtitle'>"+c.subTitle+"<p>").appendTo(h),c.mode==="string"&&(e=a("<div class='ui-simpledialog-controls'><input class='ui-simpledialog-input ui-input-text ui-shadow-inset ui-corner-all ui-body-"+c.pickPageInputTheme+"' type='"+(c.inputPassword===!0?"password":"text")+"' name='pickin' /></div>").bind("keyup",function(a){a.keyCode===13&&c.enterToTrigger!==!1&&c.butObj[c.enterToTrigger].trigger(c.clickEvent),a.keyCode===27&&c.escToTrigger!==!1&&c.butObj[c.escToTrigger].trigger(c.clickEvent)}).appendTo(h)),f=a("<div>",{"class":"ui-simpledialog-controls"}).appendTo(h),a.each(c.buttons,function(g,h){h=a.isFunction(h)?{click:h}:h,h=a.extend({text:g,theme:c.pickPageButtonTheme,icon:"check",iconpos:"left",closeOnClick:!0},h),d=c.butObj.push(a("<a href='#'>"+g+"</a>").appendTo(f).buttonMarkup({theme:h.theme,icon:h.icon,iconpos:h.iconpos,corners:!0,shadow:!0}).unbind("vclick").unbind("click").bind(c.clickEvent,function(){c.mode==="string"&&b.caller.attr("data-string",e.find("input").val());var a=h.click.apply(b.element[0],arguments);a!==!1&&h.closeOnClick===!0&&b.close()})),h.id!=null&&h.id.length>0&&c.butObj[d-1].attr("id",h.id),h.hidden&&c.butObj[d-1].addClass("button-hidden"),h.insertSeparator&&a("<div class='buttons-separator'>").appendTo(f)})):h=b.pickPageContent.contents(),h.appendTo(b.thisPage),g=a("<div>",{"class":"ui-simpledialog-screen ui-simpledialog-hidden"}).css({"z-index":c.zindex-1}).appendTo(b.thisPage).bind(c.clickEvent,function(a){c.forceInput||b.close(),a.preventDefault()}),c.useModal&&g.addClass("ui-simpledialog-screen-modal"),a.extend(b,{pickerContent:h,pickerHeader:i,screen:g})},disable:function(){this.options.disabled=!0},enable:function(){this.options.disabled=!1}})})(jQuery)